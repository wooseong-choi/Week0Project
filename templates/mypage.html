<!DOCTYPE html>
<html lang="en">
<head>
  {% include 'header.html' %}
  <title>Document</title>
</head>
<script>
  {% if error %}
    alert('회원정보가 없습니다.');
  {% endif %}

  function openPop(objId){
    
    $('[name=title]').val('');
    $('[name=content]').val('');
    $('[name=bookImg]').attr('src','');

    $.ajax({
      type:'POST',
      url:'/mypage/{{ name }}/bookEdit',
      data:{'objId':objId },
      success: function(response){
        console.log(response);
        var result = response.result[0];
        $('[name=title]').val(result.book_name);
        $('[name=content]').val(result.book_comment);
        $('[name=bookImg]').attr('src',result.book_comment);

        $('#joinBtn').attr('onclick',"join('"+objId+"')");
        $('#rejectBtn').attr('onclick',"reject('"+objId+"')");

      }
    });
    
  }

  function openRentalPop(objId){
    
    $('[name=title]').val('');
    $('[name=content]').val('');
    $('[name=bookImg]').attr('src','');

    $('[name=place]').val('');
    $('[name=time]').val('');
    $('[name=period]').val('');

    $('#status').html('');

    $.ajax({
      type:'POST',
      url:'/mypage/{{ name }}/rental',
      data:{'objId':objId },
      success: function(response){
        console.log(response);
        var result = response.result[0];
        $('[name=title]').val(result.book_name);
        $('[name=content]').val(result.book_comment);
        $('[name=bookImg]').attr('src',result.book_comment);

        $('#joinBtn').attr('onclick',"join('"+objId+"')");
        $('#rejectBtn').attr('onclick',"reject('"+objId+"')");

        var rental = response.rental[0];
        $('[name=place]').val(rental.rental_place);
        $('[name=time]').val(rental.rental_time);
        $('[name=period]').val(rental.rental_period);

        $('#status').html(rental.rental_status);

      }
    });
    
  }

  function join(objId){

    $.ajax({
      type:'POST',
      url:'/mypage/{{ name }}/join',
      data:{'objId':objId },
      success: function(response){
        console.log(response);
        var result = response.result;
        if(result == 'success'){
          alert('대여 요청을 수락하였습니다.');
        }else{
          alert('오류로 인해 대여 요청이 수락되지 않았습니다. 잠시 후 다시 시도해 주세요.');
        }


      }
    });
    
  }

  function reject(objId){

    $.ajax({
      type:'POST',
      url:'/mypage/{{ name }}/reject',
      data:{'objId':objId },
      success: function(response){
        console.log(response);
        var result = response.result;
        if(result == 'success'){
          alert('대여 요청을 거절하였습니다.');
        }else{
          alert('오류로 인해 대여 요청이 거절되지 않았습니다. 잠시 후 다시 시도해 주세요.');
        }

      }
    });

  }

</script>
<body>
  <div class="w-full flex text-center">
    <div class="w-1/2">
      <div><p>등록된 도서</p></div>
      <ul>
        {% for item in book %}
        <li data-modal-target="static-modal" data-modal-toggle="static-modal" ><span onclick="openPop('{{ item['_id'] }}')">{{ item['book_name'] }}</span></li>
        {% endfor %}
      </ul>
    </div>
    <div class="w-1/2">
      <div><p>대여 요청</p></div>
      <ul>
        {% for item in rental %}
          {% for rTemp in item %}
        <li data-modal-target="static-modal" data-modal-toggle="static-modal" ><span onclick="openRentalPop('{{ rTemp['_id'] }}')">{{ rTemp['book_name'] }}</span></li>
          {% endfor %}
        {% endfor %}
      </ul>
    </div>
  </div>




<!-- Main modal -->
<div id="static-modal" data-modal-backdrop="static" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative p-4 w-full max-w-2xl max-h-full">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
            <!-- Modal header -->
            <div class="flex relative items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                <div class="w-full flex items-center justify-between " >
                  <div class="w-1/2">
                    <img name="bookImg" src="https://img.freepik.com/premium-psd/tomato-sauce-in-a-bowl-isolated-on-alpha-layer_253984-7534.jpg?w=1060">
                  </div>
                  <div class="w-1/2 px-5 ">
                    상태 : <span id="status"></span>
                    <input name="title" readonly="readonly" class="px-3 py-2 bg-white border shadow-sm border-slate-300 placeholder-slate-400 disabled:bg-slate-50 disabled:text-slate-500 disabled:border-slate-200 focus:outline-none focus:border-sky-500 focus:ring-sky-500 block w-full rounded-md sm:text-sm focus:ring-1 invalid:border-pink-500 invalid:text-pink-600 focus:invalid:border-pink-500 focus:invalid:ring-pink-500 disabled:shadow-none">
                    <textarea name="content" readonly="readonly" class="mt-1 px-3 py-2 bg-white border shadow-sm border-slate-300 placeholder-slate-400 focus:outline-none focus:border-sky-500 focus:ring-sky-500 block w-full rounded-md sm:text-sm focus:ring-1"></textarea>
                  </div>
                </div>
                <button type="button" class="absolute top-0 right-0 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="static-modal">
                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body -->
            <div class="p-4 md:p-5 space-y-4 w-full flex" >
                <div class="w-8/12 mt-0">
                  장소 : <input name="place" class="mt-1 px-3 py-2 bg-white border shadow-sm border-slate-300 placeholder-slate-400 disabled:bg-slate-50 disabled:text-slate-500 disabled:border-slate-200 focus:outline-none focus:border-sky-500 focus:ring-sky-500 inline-block w-4/5 rounded-md sm:text-sm focus:ring-1 invalid:border-pink-500 invalid:text-pink-600 focus:invalid:border-pink-500 focus:invalid:ring-pink-500 disabled:shadow-none"><br>
                  시간 : <input name="time" class="mt-1 px-3 py-2 bg-white border shadow-sm border-slate-300 placeholder-slate-400 disabled:bg-slate-50 disabled:text-slate-500 disabled:border-slate-200 focus:outline-none focus:border-sky-500 focus:ring-sky-500 inline-block w-4/5 rounded-md sm:text-sm focus:ring-1 invalid:border-pink-500 invalid:text-pink-600 focus:invalid:border-pink-500 focus:invalid:ring-pink-500 disabled:shadow-none"><br>
                  기간 : <input name="period" class="mt-1 px-3 py-2 bg-white border shadow-sm border-slate-300 placeholder-slate-400 disabled:bg-slate-50 disabled:text-slate-500 disabled:border-slate-200 focus:outline-none focus:border-sky-500 focus:ring-sky-500 inline-block w-4/5 rounded-md sm:text-sm focus:ring-1 invalid:border-pink-500 invalid:text-pink-600 focus:invalid:border-pink-500 focus:invalid:ring-pink-500 disabled:shadow-none">
                </div>
                <div class="w-4/12 mt-0 items-center pr-5" style="margin-top: 0!important; ">
                  <!-- <button class="mt-1 inline-flex items-center px-4 py-2 font-semibold leading-6 text-sm shadow rounded-md text-white bg-indigo-500">채팅하기</button><br> -->
                  <button id="joinBtn" class="w-full mt-1 inline-flex items-center px-4 py-2 font-semibold leading-10 text-sm shadow rounded-md text-white bg-indigo-500" onclick="join()">수락</button><br>
                  <button id="rejectBtn" class="w-full mt-1 inline-flex items-center px-4 py-2 font-semibold leading-10 text-sm shadow rounded-md text-white bg-indigo-500" onclick="reject()">거절</button>
                </div>
            </div>
        </div>
    </div>
</div>



</body>

<<<<<<< HEAD
=======

>>>>>>> 1d22649a98e0c4b5b7e4ee01463d4cc771bb8b28
</html>